{"version":3,"file":"performance.test.js","mappings":"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","sources":["webpack://product-data-api/webpack/bootstrap","webpack://product-data-api/webpack/runtime/compat get default export","webpack://product-data-api/webpack/runtime/define property getters","webpack://product-data-api/webpack/runtime/hasOwnProperty shorthand","webpack://product-data-api/webpack/runtime/make namespace object","webpack://product-data-api/external commonjs \"https://jslib.k6.io/k6-summary/0.0.3/index.js\"","webpack://product-data-api/external commonjs \"k6/execution\"","webpack://product-data-api/external commonjs \"k6/http\"","webpack://product-data-api/./src/models.ts","webpack://product-data-api/external commonjs \"k6\"","webpack://product-data-api/external commonjs \"k6/data\"","webpack://product-data-api/./src/utils.ts","webpack://product-data-api/./src/tests/performance.test.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"https://jslib.k6.io/k6-summary/0.0.3/index.js\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/execution\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/http\");","import { RequestBody } from 'k6/http';\n\nexport enum HTTP_METHOD {\n  GET = 'GET',\n  POST = 'POST',\n}\n\nexport interface TestsFile {\n  requests: REQUEST[];\n}\n\nexport type BodyType = Record<string, unknown>;\n\nexport interface REQUEST {\n  disable: boolean;\n  method: HTTP_METHOD;\n  path: string;\n  body: BodyType;\n  threshold: number;\n  tag: string;\n}\n\nexport type Threshold = Record<string, string[]>;\n\nexport interface Tag {\n  [name: string]: string;\n}\n\nexport interface ThresholdAndTags {\n  thresholds: Threshold;\n  tags: Tag[];\n}\n\nexport interface AuthInfo {\n  url: string;\n  data: RequestBody;\n  tokenPath: string;\n}\n\nexport interface CONFIG {\n  authInfo: AuthInfo;\n  baseUrl: string;\n  requests: REQUEST[];\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/data\");","import { check } from 'k6';\nimport { SharedArray } from 'k6/data';\nimport http from 'k6/http';\nimport { AuthInfo, BodyType, CONFIG, REQUEST, TestsFile, ThresholdAndTags } from '../models';\n\nexport class Utils {\n  static loadConfig = (): CONFIG => {\n    return {\n      authInfo: getData<AuthInfo>(`${__ENV.AUTH_INFO}`),\n      baseUrl: `${__ENV.API_URL}`,\n      requests: getRequests(`${__ENV.DATA_FILE}`),\n    };\n  };\n\n  static getAuthToken = (authInfo: AuthInfo) => {\n    const loginRes = http.post(authInfo.url, authInfo.data, { responseType: 'text' });\n    const authToken = loginRes.json(authInfo.tokenPath);\n    check(authToken, { 'logged in successfully': () => authToken !== '' });\n    return authToken;\n  };\n\n  static getThresholdsAndTags = (requests: REQUEST[]): ThresholdAndTags => {\n    return requests.reduce(\n      (thresholdAndTags: ThresholdAndTags, request: REQUEST) => {\n        thresholdAndTags.thresholds[`http_req_duration{name:${request.tag}}`] = [`min<=${request.threshold}`];\n        thresholdAndTags.tags.push({ name: request.tag });\n        return thresholdAndTags;\n      },\n      { thresholds: {}, tags: [] }\n    );\n  };\n}\n\n/////// Private methods ///////\nconst getData = <T>(filePath: string): T => {\n  return JSON.parse(open(filePath));\n};\n\nconst getRequests = (filePath: string): REQUEST[] => {\n  return new SharedArray('requests', function () {\n    const loadedRequests: REQUEST[] = getData<TestsFile>(filePath).requests;\n    return loadedRequests.reduce((requestsToTest: REQUEST[], request: REQUEST) => {\n      if (request.disable) return requestsToTest;\n      if (request.body.name_of_the_file) {\n        request.body = getData<BodyType>(`${request.body.name_of_the_file}`);\n      }\n      requestsToTest.push(request);\n      return requestsToTest;\n    }, []);\n  });\n};\n","import { textSummary } from 'https://jslib.k6.io/k6-summary/0.0.3/index.js';\nimport exec from 'k6/execution';\nimport http, { Params } from 'k6/http';\nimport { Options } from 'k6/options.js';\nimport { CONFIG, HTTP_METHOD, ThresholdAndTags } from '../models';\nimport { Utils } from '../utils';\n\nconst config: CONFIG = Utils.loadConfig();\nconst thresholdAndTags: ThresholdAndTags = Utils.getThresholdsAndTags(config.requests);\n\nhttp.setResponseCallback(http.expectedStatuses(200));\n\n// Init code (Once per VU)\nexport const options: Options = {\n  vus: 1,\n  iterations: 3,\n  discardResponseBodies: true,\n  noCookiesReset: true,\n  insecureSkipTLSVerify: true,\n  thresholds: {\n    'iteration_duration{group:::setup}': [`max>=0`],\n    'iteration_duration{scenario:default}': [`max>=0`],\n    'http_req_duration{group:::setup}': [`max>=0`],\n    'http_req_duration{scenario:default}': [`max>=0`],\n    http_req_failed: ['rate===0'],\n    ...thresholdAndTags.thresholds,\n  },\n};\n\n// Setup code (Once)\nexport function setup() {\n  const authToken = Utils.getAuthToken(config.authInfo);\n  return {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${authToken}`,\n    },\n  };\n}\n\n// VU code (Once per iteration, as many times as the test options require)\nexport default function (params: Params) {\n  config.requests.forEach((request, index) => {\n    const url = `${config.baseUrl}${request.path}`;\n    params.tags = thresholdAndTags.tags[index];\n\n    switch (request.method.toUpperCase()) {\n      case HTTP_METHOD.GET:\n        http.get(url, params);\n        break;\n      case HTTP_METHOD.POST:\n        http.post(url, JSON.stringify(request.body), params);\n        break;\n      default:\n        // will abort the test returning the exit code 108\n        exec.test.abort(`Request: '${request.tag}', Invalid method: '${request.method}'. Possible values: [GET, POST].`);\n    }\n  });\n}\n\n// After your test runs, k6 aggregates your metrics into a JavaScript object. The handleSummary() function takes this object as an argument\nexport function handleSummary(data: unknown) {\n  let manipulatedData = JSON.parse(JSON.stringify(data));\n  delete manipulatedData.setup_data;\n  return {\n    stdout: textSummary(manipulatedData, { indent: ' ', enableColors: true }),\n    'summary.json': JSON.stringify(manipulatedData),\n  };\n}\n"],"names":["HTTP_METHOD","check","SharedArray","http","Utils","_createClass","_classCallCheck","_defineProperty","authInfo","getData","concat","__ENV","AUTH_INFO","baseUrl","API_URL","requests","getRequests","DATA_FILE","loginRes","post","url","data","responseType","authToken","json","tokenPath","loggedInSuccessfully","reduce","thresholdAndTags","request","thresholds","tag","threshold","tags","push","name","filePath","JSON","parse","open","loadedRequests","requestsToTest","disable","body","name_of_the_file","textSummary","exec","config","loadConfig","getThresholdsAndTags","setResponseCallback","expectedStatuses","options","vus","iterations","discardResponseBodies","noCookiesReset","insecureSkipTLSVerify","_objectSpread","http_req_failed","setup","getAuthToken","headers","Authorization","params","forEach","index","path","method","toUpperCase","GET","get","POST","stringify","test","abort","handleSummary","manipulatedData","setup_data","stdout","indent","enableColors"],"sourceRoot":""}